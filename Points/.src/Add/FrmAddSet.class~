' Gambas class file


Public Sub Form_Show()

    Me.SetFocus()
    Me.Center()

End

Public Sub BtnExit_Click()

    Me.Close()

End

Public Sub BtnAdd_Click()

    Dim ObjConnect As New Connection
    Dim ObjRes As Result
    Dim catalog As String
    Dim Count, MaxID, i As Integer
    
    Dim RSpace As String
    
    ObjConnect.Type = "sqlite3"
    ObjConnect.Host = User.Home
    ObjConnect.Name = User.Home & "/.Points/DB/Points"
    
    RSpace = TxtSet.Text
    
    'Message(Application.Path & "/Points")
    If TxtSet.Text Then
        
        ObjConnect.Open()
        'Message(ObjConnect.Version)
        ObjRes = ObjConnect.Exec("select count(catalogname) as Count from catalogs where lower(catalogname)='" & Lower(RSpace) & "'")
        
        Count = CInt(ObjRes!Count)
        If count > 0 Then
            Message("نام دسته تکراری است")
        Else
            ObjRes = ObjConnect.Exec("select max(id)as MaxID from catalogs")
           ' Message(ObjRes!MaxID)
            Try MaxID = ObjRes!MaxID
            If Error Then
                MaxID = 0
            Endif
            MaxID += 1
            ObjConnect.Exec("insert into catalogs(id,catalogname) values(" & MaxID & ",'" & RSpace & "')")
            ObjConnect.Commit()
            TxtSet.Clear()
        Endif
        ObjConnect.Close()
    
    Else
        Message.Warning("لطفا نام دسته را وارد کنید")
    Endif
    
    'Message(count)
    ' id = res!id
    ' Message(id)
    ' 
    ' id = res!id
    ' Message(id)
    ' 
    ' For i = 0 To (res.Count - 1)
    '     catalog = res!catalog
    '     Message(catalog)
    '     res.MoveNext()
    ' Next
    
    
    

End
